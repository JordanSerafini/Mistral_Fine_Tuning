{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"montre moi les projet terminé le mois dernier"},{"role":"assistant","content":"Vous souhaitez voir les projets qui ont été terminés le mois dernier ?\n\nIntention identifiée : Suivi de projet - Projets terminés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name, p.description, p.start_date, p.end_date,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       CONCAT(s.firstname, ' ', s.lastname) AS chef_projet\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_staff ps ON p.id = ps.project_id\nJOIN staff s ON ps.staff_id = s.id\nWHERE p.status = 'termine'\n  AND ps.role = 'chef de projet'\n  AND EXTRACT(MONTH FROM p.end_date) = EXTRACT(MONTH FROM CURRENT_DATE - INTERVAL '1 month')\n  AND EXTRACT(YEAR FROM p.end_date) = EXTRACT(YEAR FROM CURRENT_DATE - INTERVAL '1 month')\nORDER BY p.end_date DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le plus de projet?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le plus grand nombre de projets ?\n\nIntention identifiée : Gestion des clients - Analyse de portefeuille client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(p.id) AS nombre_projets,\n       SUM(CASE WHEN p.status = 'termine' THEN 1 ELSE 0 END) AS projets_termines,\n       SUM(CASE WHEN p.status = 'en_cours' THEN 1 ELSE 0 END) AS projets_en_cours,\n       MAX(p.end_date) AS date_dernier_projet\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nGROUP BY c.id\nORDER BY nombre_projets DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel fournisseur a le meilleur delai de livraison?"},{"role":"assistant","content":"Vous souhaitez savoir quel fournisseur offre les meilleurs délais de livraison ?\n\nIntention identifiée : Gestion des fournisseurs - Analyse des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT s.id, s.name AS fournisseur, s.contact_name, s.phone, s.email,\n       AVG(so.lead_time_days) AS delai_moyen,\n       COUNT(so.id) AS nombre_commandes,\n       AVG(CASE WHEN so.actual_delivery_date IS NOT NULL \n           THEN (so.actual_delivery_date - so.order_date) \n           ELSE NULL END) AS delai_reel_moyen\nFROM suppliers s\nJOIN supplier_orders so ON s.id = so.supplier_id\nWHERE so.order_date > (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY s.id\nHAVING COUNT(so.id) >= 5\nORDER BY delai_reel_moyen ASC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel materiau coute le plus cher?"},{"role":"assistant","content":"Vous souhaitez savoir quels matériaux sont les plus coûteux ?\n\nIntention identifiée : Gestion des stocks - Analyse des coûts\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT m.id, m.name, m.description, m.unit, m.price,\n       m.quantity, (m.price * m.quantity) AS valeur_stock\nFROM materials m\nWHERE m.price > 0\nORDER BY m.price DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"trouve moi les projet avec depassement de budget"},{"role":"assistant","content":"Vous souhaitez identifier les projets qui ont dépassé leur budget ?\n\nIntention identifiée : Analyse financière - Dépassements budgétaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name AS nom_projet, p.status,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       pb.total_budget AS budget_initial,\n       SUM(e.amount) AS depenses_totales,\n       (SUM(e.amount) - pb.total_budget) AS depassement,\n       ROUND(((SUM(e.amount) - pb.total_budget) / pb.total_budget) * 100, 2) AS pourcentage_depassement\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_budgets pb ON p.id = pb.project_id\nJOIN expenses e ON p.id = e.project_id\nGROUP BY p.id, c.id, pb.id\nHAVING SUM(e.amount) > pb.total_budget\nORDER BY pourcentage_depassement DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel machine a besoin de maintenance?"},{"role":"assistant","content":"Vous souhaitez savoir quels équipements nécessitent une maintenance prochainement ?\n\nIntention identifiée : Gestion des équipements - Maintenance préventive\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT e.id, e.name, e.reference, ec.name AS categorie,\n       e.last_maintenance_date, e.next_maintenance_date,\n       CURRENT_DATE - e.next_maintenance_date AS jours_retard,\n       e.status, e.location\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nWHERE e.next_maintenance_date <= (CURRENT_DATE + INTERVAL '30 days')\nORDER BY e.next_maintenance_date ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client na pas payé ses facture?"},{"role":"assistant","content":"Vous souhaitez identifier les clients qui ont des factures impayées ?\n\nIntention identifiée : Facturation et comptabilité - Suivi des impayés par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(i.id) AS nombre_factures_impayees,\n       SUM(i.total_ttc) AS montant_total_impaye,\n       MIN(i.due_date) AS echeance_plus_ancienne,\n       MAX(CURRENT_DATE - i.due_date) AS jours_retard_max\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status IN ('envoyée', 'en_retard')\n  AND i.due_date < CURRENT_DATE\nGROUP BY c.id\nORDER BY jours_retard_max DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le CA par type de projet?"},{"role":"assistant","content":"Vous souhaitez connaître le chiffre d'affaires réparti par type de projet ?\n\nIntention identifiée : Analyse financière - Répartition du chiffre d'affaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS chiffre_affaires,\n    ROUND(AVG(i.total_ttc), 2) AS montant_moyen\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status = 'payée'\n  AND p.status = 'termine'\nGROUP BY type_projet\nORDER BY chiffre_affaires DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le taux de conversion des devis?"},{"role":"assistant","content":"Vous souhaitez connaître le taux de conversion des devis en projets ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    EXTRACT(YEAR FROM q.created_date) AS annee,\n    EXTRACT(MONTH FROM q.created_date) AS mois,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    SUM(CASE WHEN q.status = 'refusé' THEN 1 ELSE 0 END) AS devis_refuses,\n    SUM(CASE WHEN q.status = 'en_attente' THEN 1 ELSE 0 END) AS devis_en_attente,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion\nFROM quotations q\nWHERE q.created_date >= (CURRENT_DATE - INTERVAL '12 months')\nGROUP BY annee, mois\nORDER BY annee DESC, mois DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le delai moyen de paiement des client?"},{"role":"assistant","content":"Vous souhaitez connaître le délai moyen de paiement des clients ?\n\nIntention identifiée : Facturation et comptabilité - Analyse des délais de paiement\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(i.id) AS nombre_factures,\n    ROUND(AVG(p.payment_date - i.issue_date), 1) AS delai_moyen_jours,\n    ROUND(AVG(p.payment_date - i.due_date), 1) AS ecart_echeance_jours,\n    SUM(i.total_ttc) AS montant_total,\n    MAX(p.payment_date) AS dernier_paiement\nFROM clients c\nJOIN projects pr ON c.id = pr.client_id\nJOIN invoices i ON pr.id = i.project_id\nJOIN payments p ON i.id = p.invoice_id\nWHERE i.status = 'payée'\n  AND i.issue_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY c.id\nHAVING COUNT(i.id) >= 3\nORDER BY delai_moyen_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la charge de travail par employé ce mois?"},{"role":"assistant","content":"Vous souhaitez connaître la charge de travail de chaque employé pour le mois en cours ?\n\nIntention identifiée : Gestion des ressources humaines - Répartition de la charge de travail\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(DISTINCT p.id) AS nombre_projets,\n    SUM(t.hours) AS heures_travaillees,\n    STRING_AGG(DISTINCT p.name, ', ') AS liste_projets,\n    ROUND(SUM(t.hours) / COUNT(DISTINCT t.date), 2) AS moyenne_heures_par_jour\nFROM staff s\nJOIN timesheet_entries t ON s.id = t.staff_id\nJOIN projects p ON t.project_id = p.id\nWHERE EXTRACT(MONTH FROM t.date) = EXTRACT(MONTH FROM CURRENT_DATE)\n  AND EXTRACT(YEAR FROM t.date) = EXTRACT(YEAR FROM CURRENT_DATE)\nGROUP BY s.id\nORDER BY heures_travaillees DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen par m2 des projet de renovation?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen par mètre carré des projets de rénovation ?\n\nIntention identifiée : Analyse financière - Coûts unitaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name, \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    SUM(e.amount) AS cout_total,\n    (p.search_metadata->>'surface_m2')::numeric AS surface,\n    ROUND(SUM(e.amount) / (p.search_metadata->>'surface_m2')::numeric, 2) AS cout_par_m2\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.name ILIKE '%rénovation%'\n  AND p.status = 'termine'\n  AND p.search_metadata ? 'surface_m2'\n  AND (p.search_metadata->>'surface_m2')::numeric > 0\nGROUP BY p.id, c.id\nORDER BY cout_par_m2 ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel projet a utilisé le plus de materiaux?"},{"role":"assistant","content":"Vous souhaitez savoir quel projet a consommé le plus de matériaux ?\n\nIntention identifiée : Gestion des stocks - Consommation de matériaux par projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS nom_projet, p.status,\n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(DISTINCT pm.material_id) AS nombre_materiaux_differents,\n    SUM(pm.quantity) AS quantite_totale,\n    SUM(pm.quantity * pm.unit_price) AS cout_total_materiaux,\n    STRING_AGG(DISTINCT m.name, ', ' ORDER BY m.name) AS principaux_materiaux\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_materials pm ON p.id = pm.project_id\nJOIN materials m ON pm.material_id = m.id\nGROUP BY p.id, c.id\nORDER BY quantite_totale DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel zone geografik a le plus de chantier?"},{"role":"assistant","content":"Vous souhaitez savoir dans quelle zone géographique se concentrent le plus de projets ?\n\nIntention identifiée : Analyse géographique - Répartition des projets\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.zip_code, p.city,\n    COUNT(p.id) AS nombre_projets,\n    COUNT(CASE WHEN p.status = 'en_cours' THEN 1 ELSE NULL END) AS projets_en_cours,\n    COUNT(CASE WHEN p.status = 'termine' THEN 1 ELSE NULL END) AS projets_termines,\n    SUM(i.total_ttc) AS chiffre_affaires_total\nFROM projects p\nLEFT JOIN invoices i ON p.id = i.project_id\nWHERE p.zip_code IS NOT NULL AND p.city IS NOT NULL\nGROUP BY p.zip_code, p.city\nORDER BY nombre_projets DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le top 5 des produit les plus commandé?"},{"role":"assistant","content":"Vous souhaitez connaître les 5 produits les plus fréquemment commandés ?\n\nIntention identifiée : Gestion des achats - Produits les plus commandés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS produit, p.reference, pc.name AS categorie,\n    s.name AS fournisseur_principal,\n    COUNT(oi.id) AS nombre_commandes,\n    SUM(oi.quantity) AS quantite_totale,\n    SUM(oi.total_price) AS montant_total,\n    ROUND(AVG(oi.unit_price), 2) AS prix_moyen\nFROM products p\nJOIN product_categories pc ON p.category_id = pc.id\nJOIN suppliers s ON p.supplier_id = s.id\nJOIN order_items oi ON p.id = oi.product_id\nJOIN supplier_orders so ON oi.order_id = so.id\nWHERE so.order_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY p.id, pc.id, s.id\nORDER BY nombre_commandes DESC, quantite_totale DESC\nLIMIT 5"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la duré moyenne des chantier par type?"},{"role":"assistant","content":"Vous souhaitez connaître la durée moyenne des projets selon leur type ?\n\nIntention identifiée : Suivi de projet - Analyse des durées\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    ROUND(AVG(p.end_date - p.start_date), 1) AS duree_moyenne_jours,\n    MIN(p.end_date - p.start_date) AS duree_min_jours,\n    MAX(p.end_date - p.start_date) AS duree_max_jours\nFROM projects p\nWHERE p.status = 'termine'\n  AND p.start_date IS NOT NULL\n  AND p.end_date IS NOT NULL\nGROUP BY type_projet\nORDER BY duree_moyenne_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le meilleur taux de conversion de devis?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le meilleur taux d'acceptation des devis ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion,\n    SUM(CASE WHEN q.status = 'accepté' THEN q.total ELSE 0 END) AS montant_total_accepte\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN quotations q ON p.id = q.project_id\nGROUP BY c.id\nHAVING COUNT(q.id) >= 3\nORDER BY taux_conversion DESC, nombre_devis DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le ratio de rentabilité par type de chantier?"},{"role":"assistant","content":"Vous souhaitez connaître le ratio de rentabilité pour chaque type de projet ?\n\nIntention identifiée : Analyse financière - Rentabilité par type de projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS revenus_totaux,\n    SUM(e.amount) AS depenses_totales,\n    SUM(i.total_ttc - e.amount) AS marge_brute,\n    ROUND(AVG((i.total_ttc - e.amount) / NULLIF(i.total_ttc, 0) * 100), 2) AS taux_marge_moyen,\n    ROUND(SUM(i.total_ttc - e.amount) / SUM(i.total_ttc) * 100, 2) AS taux_marge_global\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.status = 'termine'\nGROUP BY type_projet\nORDER BY taux_marge_global DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel employé a le meilleur taux de satisfaction client?"},{"role":"assistant","content":"Vous souhaitez savoir quel membre du personnel obtient les meilleures évaluations de satisfaction client ?\n\nIntention identifiée : Gestion des ressources humaines - Évaluation des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(t.id) AS nombre_evaluations,\n    ROUND(AVG(t.rating), 2) AS note_moyenne,\n    COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END) AS nombre_5_etoiles,\n    ROUND(COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END)::float / COUNT(t.id) * 100, 2) AS pourcentage_5_etoiles\nFROM staff s\nJOIN project_staff ps ON s.id = ps.staff_id\nJOIN projects p ON ps.project_id = p.id\nJOIN testimonials t ON p.id = t.project_id\nWHERE ps.role = 'chef de projet'\n  AND t.is_published = true\nGROUP BY s.id\nHAVING COUNT(t.id) >= 3\nORDER BY note_moyenne DESC, nombre_evaluations DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen des reparation des machine?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen des réparations et maintenance des équipements ?\n\nIntention identifiée : Gestion des équipements - Analyse des coûts de maintenance\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    ec.name AS categorie_equipement,\n    COUNT(DISTINCT e.id) AS nombre_equipements,\n    COUNT(mr.id) AS nombre_interventions,\n    ROUND(AVG(mr.cost), 2) AS cout_moyen_intervention,\n    SUM(mr.cost) AS cout_total,\n    MAX(mr.maintenance_date) AS derniere_intervention\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nJOIN maintenance_records mr ON e.id = mr.equipment_id\nWHERE mr.maintenance_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY ec.id\nORDER BY cout_total DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"montre moi les projet terminé le mois dernier"},{"role":"assistant","content":"Vous souhaitez voir les projets qui ont été terminés le mois dernier ?\n\nIntention identifiée : Suivi de projet - Projets terminés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name, p.description, p.start_date, p.end_date,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       CONCAT(s.firstname, ' ', s.lastname) AS chef_projet\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_staff ps ON p.id = ps.project_id\nJOIN staff s ON ps.staff_id = s.id\nWHERE p.status = 'termine'\n  AND ps.role = 'chef de projet'\n  AND EXTRACT(MONTH FROM p.end_date) = EXTRACT(MONTH FROM CURRENT_DATE - INTERVAL '1 month')\n  AND EXTRACT(YEAR FROM p.end_date) = EXTRACT(YEAR FROM CURRENT_DATE - INTERVAL '1 month')\nORDER BY p.end_date DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le plus de projet?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le plus grand nombre de projets ?\n\nIntention identifiée : Gestion des clients - Analyse de portefeuille client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(p.id) AS nombre_projets,\n       SUM(CASE WHEN p.status = 'termine' THEN 1 ELSE 0 END) AS projets_termines,\n       SUM(CASE WHEN p.status = 'en_cours' THEN 1 ELSE 0 END) AS projets_en_cours,\n       MAX(p.end_date) AS date_dernier_projet\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nGROUP BY c.id\nORDER BY nombre_projets DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel fournisseur a le meilleur delai de livraison?"},{"role":"assistant","content":"Vous souhaitez savoir quel fournisseur offre les meilleurs délais de livraison ?\n\nIntention identifiée : Gestion des fournisseurs - Analyse des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT s.id, s.name AS fournisseur, s.contact_name, s.phone, s.email,\n       AVG(so.lead_time_days) AS delai_moyen,\n       COUNT(so.id) AS nombre_commandes,\n       AVG(CASE WHEN so.actual_delivery_date IS NOT NULL \n           THEN (so.actual_delivery_date - so.order_date) \n           ELSE NULL END) AS delai_reel_moyen\nFROM suppliers s\nJOIN supplier_orders so ON s.id = so.supplier_id\nWHERE so.order_date > (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY s.id\nHAVING COUNT(so.id) >= 5\nORDER BY delai_reel_moyen ASC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel materiau coute le plus cher?"},{"role":"assistant","content":"Vous souhaitez savoir quels matériaux sont les plus coûteux ?\n\nIntention identifiée : Gestion des stocks - Analyse des coûts\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT m.id, m.name, m.description, m.unit, m.price,\n       m.quantity, (m.price * m.quantity) AS valeur_stock\nFROM materials m\nWHERE m.price > 0\nORDER BY m.price DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"trouve moi les projet avec depassement de budget"},{"role":"assistant","content":"Vous souhaitez identifier les projets qui ont dépassé leur budget ?\n\nIntention identifiée : Analyse financière - Dépassements budgétaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name AS nom_projet, p.status,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       pb.total_budget AS budget_initial,\n       SUM(e.amount) AS depenses_totales,\n       (SUM(e.amount) - pb.total_budget) AS depassement,\n       ROUND(((SUM(e.amount) - pb.total_budget) / pb.total_budget) * 100, 2) AS pourcentage_depassement\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_budgets pb ON p.id = pb.project_id\nJOIN expenses e ON p.id = e.project_id\nGROUP BY p.id, c.id, pb.id\nHAVING SUM(e.amount) > pb.total_budget\nORDER BY pourcentage_depassement DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel machine a besoin de maintenance?"},{"role":"assistant","content":"Vous souhaitez savoir quels équipements nécessitent une maintenance prochainement ?\n\nIntention identifiée : Gestion des équipements - Maintenance préventive\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT e.id, e.name, e.reference, ec.name AS categorie,\n       e.last_maintenance_date, e.next_maintenance_date,\n       CURRENT_DATE - e.next_maintenance_date AS jours_retard,\n       e.status, e.location\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nWHERE e.next_maintenance_date <= (CURRENT_DATE + INTERVAL '30 days')\nORDER BY e.next_maintenance_date ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client na pas payé ses facture?"},{"role":"assistant","content":"Vous souhaitez identifier les clients qui ont des factures impayées ?\n\nIntention identifiée : Facturation et comptabilité - Suivi des impayés par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(i.id) AS nombre_factures_impayees,\n       SUM(i.total_ttc) AS montant_total_impaye,\n       MIN(i.due_date) AS echeance_plus_ancienne,\n       MAX(CURRENT_DATE - i.due_date) AS jours_retard_max\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status IN ('envoyée', 'en_retard')\n  AND i.due_date < CURRENT_DATE\nGROUP BY c.id\nORDER BY jours_retard_max DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le CA par type de projet?"},{"role":"assistant","content":"Vous souhaitez connaître le chiffre d'affaires réparti par type de projet ?\n\nIntention identifiée : Analyse financière - Répartition du chiffre d'affaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS chiffre_affaires,\n    ROUND(AVG(i.total_ttc), 2) AS montant_moyen\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status = 'payée'\n  AND p.status = 'termine'\nGROUP BY type_projet\nORDER BY chiffre_affaires DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le taux de conversion des devis?"},{"role":"assistant","content":"Vous souhaitez connaître le taux de conversion des devis en projets ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    EXTRACT(YEAR FROM q.created_date) AS annee,\n    EXTRACT(MONTH FROM q.created_date) AS mois,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    SUM(CASE WHEN q.status = 'refusé' THEN 1 ELSE 0 END) AS devis_refuses,\n    SUM(CASE WHEN q.status = 'en_attente' THEN 1 ELSE 0 END) AS devis_en_attente,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion\nFROM quotations q\nWHERE q.created_date >= (CURRENT_DATE - INTERVAL '12 months')\nGROUP BY annee, mois\nORDER BY annee DESC, mois DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le delai moyen de paiement des client?"},{"role":"assistant","content":"Vous souhaitez connaître le délai moyen de paiement des clients ?\n\nIntention identifiée : Facturation et comptabilité - Analyse des délais de paiement\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(i.id) AS nombre_factures,\n    ROUND(AVG(p.payment_date - i.issue_date), 1) AS delai_moyen_jours,\n    ROUND(AVG(p.payment_date - i.due_date), 1) AS ecart_echeance_jours,\n    SUM(i.total_ttc) AS montant_total,\n    MAX(p.payment_date) AS dernier_paiement\nFROM clients c\nJOIN projects pr ON c.id = pr.client_id\nJOIN invoices i ON pr.id = i.project_id\nJOIN payments p ON i.id = p.invoice_id\nWHERE i.status = 'payée'\n  AND i.issue_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY c.id\nHAVING COUNT(i.id) >= 3\nORDER BY delai_moyen_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la charge de travail par employé ce mois?"},{"role":"assistant","content":"Vous souhaitez connaître la charge de travail de chaque employé pour le mois en cours ?\n\nIntention identifiée : Gestion des ressources humaines - Répartition de la charge de travail\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(DISTINCT p.id) AS nombre_projets,\n    SUM(t.hours) AS heures_travaillees,\n    STRING_AGG(DISTINCT p.name, ', ') AS liste_projets,\n    ROUND(SUM(t.hours) / COUNT(DISTINCT t.date), 2) AS moyenne_heures_par_jour\nFROM staff s\nJOIN timesheet_entries t ON s.id = t.staff_id\nJOIN projects p ON t.project_id = p.id\nWHERE EXTRACT(MONTH FROM t.date) = EXTRACT(MONTH FROM CURRENT_DATE)\n  AND EXTRACT(YEAR FROM t.date) = EXTRACT(YEAR FROM CURRENT_DATE)\nGROUP BY s.id\nORDER BY heures_travaillees DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen par m2 des projet de renovation?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen par mètre carré des projets de rénovation ?\n\nIntention identifiée : Analyse financière - Coûts unitaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name, \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    SUM(e.amount) AS cout_total,\n    (p.search_metadata->>'surface_m2')::numeric AS surface,\n    ROUND(SUM(e.amount) / (p.search_metadata->>'surface_m2')::numeric, 2) AS cout_par_m2\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.name ILIKE '%rénovation%'\n  AND p.status = 'termine'\n  AND p.search_metadata ? 'surface_m2'\n  AND (p.search_metadata->>'surface_m2')::numeric > 0\nGROUP BY p.id, c.id\nORDER BY cout_par_m2 ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel projet a utilisé le plus de materiaux?"},{"role":"assistant","content":"Vous souhaitez savoir quel projet a consommé le plus de matériaux ?\n\nIntention identifiée : Gestion des stocks - Consommation de matériaux par projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS nom_projet, p.status,\n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(DISTINCT pm.material_id) AS nombre_materiaux_differents,\n    SUM(pm.quantity) AS quantite_totale,\n    SUM(pm.quantity * pm.unit_price) AS cout_total_materiaux,\n    STRING_AGG(DISTINCT m.name, ', ' ORDER BY m.name) AS principaux_materiaux\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_materials pm ON p.id = pm.project_id\nJOIN materials m ON pm.material_id = m.id\nGROUP BY p.id, c.id\nORDER BY quantite_totale DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel zone geografik a le plus de chantier?"},{"role":"assistant","content":"Vous souhaitez savoir dans quelle zone géographique se concentrent le plus de projets ?\n\nIntention identifiée : Analyse géographique - Répartition des projets\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.zip_code, p.city,\n    COUNT(p.id) AS nombre_projets,\n    COUNT(CASE WHEN p.status = 'en_cours' THEN 1 ELSE NULL END) AS projets_en_cours,\n    COUNT(CASE WHEN p.status = 'termine' THEN 1 ELSE NULL END) AS projets_termines,\n    SUM(i.total_ttc) AS chiffre_affaires_total\nFROM projects p\nLEFT JOIN invoices i ON p.id = i.project_id\nWHERE p.zip_code IS NOT NULL AND p.city IS NOT NULL\nGROUP BY p.zip_code, p.city\nORDER BY nombre_projets DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le top 5 des produit les plus commandé?"},{"role":"assistant","content":"Vous souhaitez connaître les 5 produits les plus fréquemment commandés ?\n\nIntention identifiée : Gestion des achats - Produits les plus commandés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS produit, p.reference, pc.name AS categorie,\n    s.name AS fournisseur_principal,\n    COUNT(oi.id) AS nombre_commandes,\n    SUM(oi.quantity) AS quantite_totale,\n    SUM(oi.total_price) AS montant_total,\n    ROUND(AVG(oi.unit_price), 2) AS prix_moyen\nFROM products p\nJOIN product_categories pc ON p.category_id = pc.id\nJOIN suppliers s ON p.supplier_id = s.id\nJOIN order_items oi ON p.id = oi.product_id\nJOIN supplier_orders so ON oi.order_id = so.id\nWHERE so.order_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY p.id, pc.id, s.id\nORDER BY nombre_commandes DESC, quantite_totale DESC\nLIMIT 5"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la duré moyenne des chantier par type?"},{"role":"assistant","content":"Vous souhaitez connaître la durée moyenne des projets selon leur type ?\n\nIntention identifiée : Suivi de projet - Analyse des durées\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    ROUND(AVG(p.end_date - p.start_date), 1) AS duree_moyenne_jours,\n    MIN(p.end_date - p.start_date) AS duree_min_jours,\n    MAX(p.end_date - p.start_date) AS duree_max_jours\nFROM projects p\nWHERE p.status = 'termine'\n  AND p.start_date IS NOT NULL\n  AND p.end_date IS NOT NULL\nGROUP BY type_projet\nORDER BY duree_moyenne_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le meilleur taux de conversion de devis?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le meilleur taux d'acceptation des devis ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion,\n    SUM(CASE WHEN q.status = 'accepté' THEN q.total ELSE 0 END) AS montant_total_accepte\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN quotations q ON p.id = q.project_id\nGROUP BY c.id\nHAVING COUNT(q.id) >= 3\nORDER BY taux_conversion DESC, nombre_devis DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le ratio de rentabilité par type de chantier?"},{"role":"assistant","content":"Vous souhaitez connaître le ratio de rentabilité pour chaque type de projet ?\n\nIntention identifiée : Analyse financière - Rentabilité par type de projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS revenus_totaux,\n    SUM(e.amount) AS depenses_totales,\n    SUM(i.total_ttc - e.amount) AS marge_brute,\n    ROUND(AVG((i.total_ttc - e.amount) / NULLIF(i.total_ttc, 0) * 100), 2) AS taux_marge_moyen,\n    ROUND(SUM(i.total_ttc - e.amount) / SUM(i.total_ttc) * 100, 2) AS taux_marge_global\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.status = 'termine'\nGROUP BY type_projet\nORDER BY taux_marge_global DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel employé a le meilleur taux de satisfaction client?"},{"role":"assistant","content":"Vous souhaitez savoir quel membre du personnel obtient les meilleures évaluations de satisfaction client ?\n\nIntention identifiée : Gestion des ressources humaines - Évaluation des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(t.id) AS nombre_evaluations,\n    ROUND(AVG(t.rating), 2) AS note_moyenne,\n    COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END) AS nombre_5_etoiles,\n    ROUND(COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END)::float / COUNT(t.id) * 100, 2) AS pourcentage_5_etoiles\nFROM staff s\nJOIN project_staff ps ON s.id = ps.staff_id\nJOIN projects p ON ps.project_id = p.id\nJOIN testimonials t ON p.id = t.project_id\nWHERE ps.role = 'chef de projet'\n  AND t.is_published = true\nGROUP BY s.id\nHAVING COUNT(t.id) >= 3\nORDER BY note_moyenne DESC, nombre_evaluations DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen des reparation des machine?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen des réparations et maintenance des équipements ?\n\nIntention identifiée : Gestion des équipements - Analyse des coûts de maintenance\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    ec.name AS categorie_equipement,\n    COUNT(DISTINCT e.id) AS nombre_equipements,\n    COUNT(mr.id) AS nombre_interventions,\n    ROUND(AVG(mr.cost), 2) AS cout_moyen_intervention,\n    SUM(mr.cost) AS cout_total,\n    MAX(mr.maintenance_date) AS derniere_intervention\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nJOIN maintenance_records mr ON e.id = mr.equipment_id\nWHERE mr.maintenance_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY ec.id\nORDER BY cout_total DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"montre moi les projet terminé le mois dernier"},{"role":"assistant","content":"Vous souhaitez voir les projets qui ont été terminés le mois dernier ?\n\nIntention identifiée : Suivi de projet - Projets terminés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name, p.description, p.start_date, p.end_date,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       CONCAT(s.firstname, ' ', s.lastname) AS chef_projet\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_staff ps ON p.id = ps.project_id\nJOIN staff s ON ps.staff_id = s.id\nWHERE p.status = 'termine'\n  AND ps.role = 'chef de projet'\n  AND EXTRACT(MONTH FROM p.end_date) = EXTRACT(MONTH FROM CURRENT_DATE - INTERVAL '1 month')\n  AND EXTRACT(YEAR FROM p.end_date) = EXTRACT(YEAR FROM CURRENT_DATE - INTERVAL '1 month')\nORDER BY p.end_date DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le plus de projet?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le plus grand nombre de projets ?\n\nIntention identifiée : Gestion des clients - Analyse de portefeuille client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(p.id) AS nombre_projets,\n       SUM(CASE WHEN p.status = 'termine' THEN 1 ELSE 0 END) AS projets_termines,\n       SUM(CASE WHEN p.status = 'en_cours' THEN 1 ELSE 0 END) AS projets_en_cours,\n       MAX(p.end_date) AS date_dernier_projet\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nGROUP BY c.id\nORDER BY nombre_projets DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel fournisseur a le meilleur delai de livraison?"},{"role":"assistant","content":"Vous souhaitez savoir quel fournisseur offre les meilleurs délais de livraison ?\n\nIntention identifiée : Gestion des fournisseurs - Analyse des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT s.id, s.name AS fournisseur, s.contact_name, s.phone, s.email,\n       AVG(so.lead_time_days) AS delai_moyen,\n       COUNT(so.id) AS nombre_commandes,\n       AVG(CASE WHEN so.actual_delivery_date IS NOT NULL \n           THEN (so.actual_delivery_date - so.order_date) \n           ELSE NULL END) AS delai_reel_moyen\nFROM suppliers s\nJOIN supplier_orders so ON s.id = so.supplier_id\nWHERE so.order_date > (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY s.id\nHAVING COUNT(so.id) >= 5\nORDER BY delai_reel_moyen ASC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel materiau coute le plus cher?"},{"role":"assistant","content":"Vous souhaitez savoir quels matériaux sont les plus coûteux ?\n\nIntention identifiée : Gestion des stocks - Analyse des coûts\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT m.id, m.name, m.description, m.unit, m.price,\n       m.quantity, (m.price * m.quantity) AS valeur_stock\nFROM materials m\nWHERE m.price > 0\nORDER BY m.price DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"trouve moi les projet avec depassement de budget"},{"role":"assistant","content":"Vous souhaitez identifier les projets qui ont dépassé leur budget ?\n\nIntention identifiée : Analyse financière - Dépassements budgétaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT p.id, p.name AS nom_projet, p.status,\n       CONCAT(c.firstname, ' ', c.lastname) AS client,\n       pb.total_budget AS budget_initial,\n       SUM(e.amount) AS depenses_totales,\n       (SUM(e.amount) - pb.total_budget) AS depassement,\n       ROUND(((SUM(e.amount) - pb.total_budget) / pb.total_budget) * 100, 2) AS pourcentage_depassement\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_budgets pb ON p.id = pb.project_id\nJOIN expenses e ON p.id = e.project_id\nGROUP BY p.id, c.id, pb.id\nHAVING SUM(e.amount) > pb.total_budget\nORDER BY pourcentage_depassement DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel machine a besoin de maintenance?"},{"role":"assistant","content":"Vous souhaitez savoir quels équipements nécessitent une maintenance prochainement ?\n\nIntention identifiée : Gestion des équipements - Maintenance préventive\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT e.id, e.name, e.reference, ec.name AS categorie,\n       e.last_maintenance_date, e.next_maintenance_date,\n       CURRENT_DATE - e.next_maintenance_date AS jours_retard,\n       e.status, e.location\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nWHERE e.next_maintenance_date <= (CURRENT_DATE + INTERVAL '30 days')\nORDER BY e.next_maintenance_date ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client na pas payé ses facture?"},{"role":"assistant","content":"Vous souhaitez identifier les clients qui ont des factures impayées ?\n\nIntention identifiée : Facturation et comptabilité - Suivi des impayés par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client, c.email, c.phone,\n       COUNT(i.id) AS nombre_factures_impayees,\n       SUM(i.total_ttc) AS montant_total_impaye,\n       MIN(i.due_date) AS echeance_plus_ancienne,\n       MAX(CURRENT_DATE - i.due_date) AS jours_retard_max\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status IN ('envoyée', 'en_retard')\n  AND i.due_date < CURRENT_DATE\nGROUP BY c.id\nORDER BY jours_retard_max DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le CA par type de projet?"},{"role":"assistant","content":"Vous souhaitez connaître le chiffre d'affaires réparti par type de projet ?\n\nIntention identifiée : Analyse financière - Répartition du chiffre d'affaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS chiffre_affaires,\n    ROUND(AVG(i.total_ttc), 2) AS montant_moyen\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nWHERE i.status = 'payée'\n  AND p.status = 'termine'\nGROUP BY type_projet\nORDER BY chiffre_affaires DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le taux de conversion des devis?"},{"role":"assistant","content":"Vous souhaitez connaître le taux de conversion des devis en projets ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    EXTRACT(YEAR FROM q.created_date) AS annee,\n    EXTRACT(MONTH FROM q.created_date) AS mois,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    SUM(CASE WHEN q.status = 'refusé' THEN 1 ELSE 0 END) AS devis_refuses,\n    SUM(CASE WHEN q.status = 'en_attente' THEN 1 ELSE 0 END) AS devis_en_attente,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion\nFROM quotations q\nWHERE q.created_date >= (CURRENT_DATE - INTERVAL '12 months')\nGROUP BY annee, mois\nORDER BY annee DESC, mois DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le delai moyen de paiement des client?"},{"role":"assistant","content":"Vous souhaitez connaître le délai moyen de paiement des clients ?\n\nIntention identifiée : Facturation et comptabilité - Analyse des délais de paiement\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(i.id) AS nombre_factures,\n    ROUND(AVG(p.payment_date - i.issue_date), 1) AS delai_moyen_jours,\n    ROUND(AVG(p.payment_date - i.due_date), 1) AS ecart_echeance_jours,\n    SUM(i.total_ttc) AS montant_total,\n    MAX(p.payment_date) AS dernier_paiement\nFROM clients c\nJOIN projects pr ON c.id = pr.client_id\nJOIN invoices i ON pr.id = i.project_id\nJOIN payments p ON i.id = p.invoice_id\nWHERE i.status = 'payée'\n  AND i.issue_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY c.id\nHAVING COUNT(i.id) >= 3\nORDER BY delai_moyen_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la charge de travail par employé ce mois?"},{"role":"assistant","content":"Vous souhaitez connaître la charge de travail de chaque employé pour le mois en cours ?\n\nIntention identifiée : Gestion des ressources humaines - Répartition de la charge de travail\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(DISTINCT p.id) AS nombre_projets,\n    SUM(t.hours) AS heures_travaillees,\n    STRING_AGG(DISTINCT p.name, ', ') AS liste_projets,\n    ROUND(SUM(t.hours) / COUNT(DISTINCT t.date), 2) AS moyenne_heures_par_jour\nFROM staff s\nJOIN timesheet_entries t ON s.id = t.staff_id\nJOIN projects p ON t.project_id = p.id\nWHERE EXTRACT(MONTH FROM t.date) = EXTRACT(MONTH FROM CURRENT_DATE)\n  AND EXTRACT(YEAR FROM t.date) = EXTRACT(YEAR FROM CURRENT_DATE)\nGROUP BY s.id\nORDER BY heures_travaillees DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen par m2 des projet de renovation?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen par mètre carré des projets de rénovation ?\n\nIntention identifiée : Analyse financière - Coûts unitaires\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name, \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    SUM(e.amount) AS cout_total,\n    (p.search_metadata->>'surface_m2')::numeric AS surface,\n    ROUND(SUM(e.amount) / (p.search_metadata->>'surface_m2')::numeric, 2) AS cout_par_m2\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.name ILIKE '%rénovation%'\n  AND p.status = 'termine'\n  AND p.search_metadata ? 'surface_m2'\n  AND (p.search_metadata->>'surface_m2')::numeric > 0\nGROUP BY p.id, c.id\nORDER BY cout_par_m2 ASC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel projet a utilisé le plus de materiaux?"},{"role":"assistant","content":"Vous souhaitez savoir quel projet a consommé le plus de matériaux ?\n\nIntention identifiée : Gestion des stocks - Consommation de matériaux par projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS nom_projet, p.status,\n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(DISTINCT pm.material_id) AS nombre_materiaux_differents,\n    SUM(pm.quantity) AS quantite_totale,\n    SUM(pm.quantity * pm.unit_price) AS cout_total_materiaux,\n    STRING_AGG(DISTINCT m.name, ', ' ORDER BY m.name) AS principaux_materiaux\nFROM projects p\nJOIN clients c ON p.client_id = c.id\nJOIN project_materials pm ON p.id = pm.project_id\nJOIN materials m ON pm.material_id = m.id\nGROUP BY p.id, c.id\nORDER BY quantite_totale DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel zone geografik a le plus de chantier?"},{"role":"assistant","content":"Vous souhaitez savoir dans quelle zone géographique se concentrent le plus de projets ?\n\nIntention identifiée : Analyse géographique - Répartition des projets\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.zip_code, p.city,\n    COUNT(p.id) AS nombre_projets,\n    COUNT(CASE WHEN p.status = 'en_cours' THEN 1 ELSE NULL END) AS projets_en_cours,\n    COUNT(CASE WHEN p.status = 'termine' THEN 1 ELSE NULL END) AS projets_termines,\n    SUM(i.total_ttc) AS chiffre_affaires_total\nFROM projects p\nLEFT JOIN invoices i ON p.id = i.project_id\nWHERE p.zip_code IS NOT NULL AND p.city IS NOT NULL\nGROUP BY p.zip_code, p.city\nORDER BY nombre_projets DESC\nLIMIT 15"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le top 5 des produit les plus commandé?"},{"role":"assistant","content":"Vous souhaitez connaître les 5 produits les plus fréquemment commandés ?\n\nIntention identifiée : Gestion des achats - Produits les plus commandés\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    p.id, p.name AS produit, p.reference, pc.name AS categorie,\n    s.name AS fournisseur_principal,\n    COUNT(oi.id) AS nombre_commandes,\n    SUM(oi.quantity) AS quantite_totale,\n    SUM(oi.total_price) AS montant_total,\n    ROUND(AVG(oi.unit_price), 2) AS prix_moyen\nFROM products p\nJOIN product_categories pc ON p.category_id = pc.id\nJOIN suppliers s ON p.supplier_id = s.id\nJOIN order_items oi ON p.id = oi.product_id\nJOIN supplier_orders so ON oi.order_id = so.id\nWHERE so.order_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY p.id, pc.id, s.id\nORDER BY nombre_commandes DESC, quantite_totale DESC\nLIMIT 5"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est la duré moyenne des chantier par type?"},{"role":"assistant","content":"Vous souhaitez connaître la durée moyenne des projets selon leur type ?\n\nIntention identifiée : Suivi de projet - Analyse des durées\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    ROUND(AVG(p.end_date - p.start_date), 1) AS duree_moyenne_jours,\n    MIN(p.end_date - p.start_date) AS duree_min_jours,\n    MAX(p.end_date - p.start_date) AS duree_max_jours\nFROM projects p\nWHERE p.status = 'termine'\n  AND p.start_date IS NOT NULL\n  AND p.end_date IS NOT NULL\nGROUP BY type_projet\nORDER BY duree_moyenne_jours DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel client a le meilleur taux de conversion de devis?"},{"role":"assistant","content":"Vous souhaitez savoir quel client a le meilleur taux d'acceptation des devis ?\n\nIntention identifiée : Analyse commerciale - Taux de conversion par client\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CONCAT(c.firstname, ' ', c.lastname) AS client,\n    COUNT(q.id) AS nombre_devis,\n    SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END) AS devis_acceptes,\n    ROUND((SUM(CASE WHEN q.status = 'accepté' THEN 1 ELSE 0 END)::float / COUNT(q.id)) * 100, 2) AS taux_conversion,\n    SUM(CASE WHEN q.status = 'accepté' THEN q.total ELSE 0 END) AS montant_total_accepte\nFROM clients c\nJOIN projects p ON c.id = p.client_id\nJOIN quotations q ON p.id = q.project_id\nGROUP BY c.id\nHAVING COUNT(q.id) >= 3\nORDER BY taux_conversion DESC, nombre_devis DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le ratio de rentabilité par type de chantier?"},{"role":"assistant","content":"Vous souhaitez connaître le ratio de rentabilité pour chaque type de projet ?\n\nIntention identifiée : Analyse financière - Rentabilité par type de projet\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    CASE \n        WHEN p.name ILIKE '%rénovation%' THEN 'Rénovation'\n        WHEN p.name ILIKE '%construction%' THEN 'Construction'\n        WHEN p.name ILIKE '%extension%' THEN 'Extension'\n        WHEN p.name ILIKE '%isolation%' THEN 'Isolation'\n        WHEN p.name ILIKE '%toiture%' THEN 'Toiture'\n        WHEN p.name ILIKE '%plomberie%' THEN 'Plomberie'\n        WHEN p.name ILIKE '%électricité%' THEN 'Électricité'\n        ELSE 'Autre'\n    END AS type_projet,\n    COUNT(p.id) AS nombre_projets,\n    SUM(i.total_ttc) AS revenus_totaux,\n    SUM(e.amount) AS depenses_totales,\n    SUM(i.total_ttc - e.amount) AS marge_brute,\n    ROUND(AVG((i.total_ttc - e.amount) / NULLIF(i.total_ttc, 0) * 100), 2) AS taux_marge_moyen,\n    ROUND(SUM(i.total_ttc - e.amount) / SUM(i.total_ttc) * 100, 2) AS taux_marge_global\nFROM projects p\nJOIN invoices i ON p.id = i.project_id\nJOIN expenses e ON p.id = e.project_id\nWHERE p.status = 'termine'\nGROUP BY type_projet\nORDER BY taux_marge_global DESC"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel employé a le meilleur taux de satisfaction client?"},{"role":"assistant","content":"Vous souhaitez savoir quel membre du personnel obtient les meilleures évaluations de satisfaction client ?\n\nIntention identifiée : Gestion des ressources humaines - Évaluation des performances\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    s.id, CONCAT(s.firstname, ' ', s.lastname) AS employe, s.role,\n    COUNT(t.id) AS nombre_evaluations,\n    ROUND(AVG(t.rating), 2) AS note_moyenne,\n    COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END) AS nombre_5_etoiles,\n    ROUND(COUNT(CASE WHEN t.rating = 5 THEN 1 ELSE NULL END)::float / COUNT(t.id) * 100, 2) AS pourcentage_5_etoiles\nFROM staff s\nJOIN project_staff ps ON s.id = ps.staff_id\nJOIN projects p ON ps.project_id = p.id\nJOIN testimonials t ON p.id = t.project_id\nWHERE ps.role = 'chef de projet'\n  AND t.is_published = true\nGROUP BY s.id\nHAVING COUNT(t.id) >= 3\nORDER BY note_moyenne DESC, nombre_evaluations DESC\nLIMIT 10"}]}
{"messages":[{"role":"system","content":"Vous êtes un assistant d'analyse pour une société de BTP spécialisée dans la construction et rénovation de bâtiments."},{"role":"user","content":"kel est le cout moyen des reparation des machine?"},{"role":"assistant","content":"Vous souhaitez connaître le coût moyen des réparations et maintenance des équipements ?\n\nIntention identifiée : Gestion des équipements - Analyse des coûts de maintenance\n\nAgent à utiliser : querybuilder\n\nType de requête : \nSELECT \n    ec.name AS categorie_equipement,\n    COUNT(DISTINCT e.id) AS nombre_equipements,\n    COUNT(mr.id) AS nombre_interventions,\n    ROUND(AVG(mr.cost), 2) AS cout_moyen_intervention,\n    SUM(mr.cost) AS cout_total,\n    MAX(mr.maintenance_date) AS derniere_intervention\nFROM equipment e\nJOIN equipment_categories ec ON e.category_id = ec.id\nJOIN maintenance_records mr ON e.id = mr.equipment_id\nWHERE mr.maintenance_date >= (CURRENT_DATE - INTERVAL '1 year')\nGROUP BY ec.id\nORDER BY cout_total DESC"}]}